var http = require('http');
var fs = require('fs');

var server = new http.Server(function (req, res) {
	if(req.url == '/index.html') {
		var file = new fs.ReadStream('index.html');
		sendFile(file, res);
	}
}).listen(3000);

function sendFile(file, res) {
	
	file.pipe(res);

	file.on('error', function(err) {
		res.statusCode = 500;
		res.end('Server Error');
		console.log(err);
	});

	file.on('open', function() {
		console.log('open 1')
	})
	.on('close', function() {
		console.log('close 1');
	})

	res.on('close', function() {
		file.destroy();
	})
}
